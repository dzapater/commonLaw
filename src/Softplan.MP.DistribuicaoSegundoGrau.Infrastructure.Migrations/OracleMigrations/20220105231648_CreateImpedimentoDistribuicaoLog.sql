DECLARE
  pCount NUMBER;
BEGIN
  pCount := 0;
  SELECT count(*) INTO pCount FROM SAJ_DSG."__MigrationsHistory" WHERE "MigrationId" = '20220105231648_CreateImpedimentoDistribuicaoLog';
  IF (pCount <> 1) THEN
    EXECUTE IMMEDIATE '
    CREATE TABLE SAJ_DSG.IMPEDIMENTO_DISTRIBUICAO_LOG ( 
      LOG_ID NUMBER(19) GENERATED BY DEFAULT ON NULL AS IDENTITY NOT NULL,
      PROCESSO_ID NVARCHAR2(200) NOT NULL,
      TRANSACTION_ID RAW(16) NOT NULL,
      TIPO_DISTRIBUICAO NUMBER(10) NOT NULL,
      PAYLOAD_TYPE NVARCHAR2(200) NULL,
      PAYLOAD_SERIALIZATION_TYPE NUMBER(10) NOT NULL,
      PAYLOAD BLOB NULL,
      METADATA_UUID RAW(16) NULL,
      METADATA_ROW_VERSION BLOB NULL,
      METADATA_DATA_INCLUSAO TIMESTAMP(7) WITH TIME ZONE NULL,
      METADATA_DATA_ATUALIZACAO TIMESTAMP(7) WITH TIME ZONE NULL,
      METADATA_USUARIO_INCLUSAO NCLOB NULL,
      METADATA_USUARIO_ATUALIZACAO NCLOB NULL,
      PRIMARY KEY (LOG_ID)
    )
';
  END IF;
END;
/
DECLARE
  pCount NUMBER;
BEGIN
  pCount := 0;
  SELECT count(*) INTO pCount FROM SAJ_DSG."__MigrationsHistory" WHERE "MigrationId" = '20220105231648_CreateImpedimentoDistribuicaoLog';
  IF (pCount <> 1) THEN
    EXECUTE IMMEDIATE '
    CREATE INDEX "impedimento_distribuicao_log_processo" ON SAJ_DSG.IMPEDIMENTO_DISTRIBUICAO_LOG (PROCESSO_ID)
';
  END IF;
END;
/
DECLARE
  pCount NUMBER;
BEGIN
  pCount := 0;
  SELECT count(*) INTO pCount FROM SAJ_DSG."__MigrationsHistory" WHERE "MigrationId" = '20220105231648_CreateImpedimentoDistribuicaoLog';
  IF (pCount <> 1) THEN
    EXECUTE IMMEDIATE '
    CREATE INDEX "impedimento_distribuicao_log_processo_transactionid" ON SAJ_DSG.IMPEDIMENTO_DISTRIBUICAO_LOG (PROCESSO_ID, TRANSACTION_ID)
';
  END IF;
END;
/
DECLARE
  pCount NUMBER;
BEGIN
  pCount := 0;
  SELECT count(*) INTO pCount FROM SAJ_DSG."__MigrationsHistory" WHERE "MigrationId" = '20220105231648_CreateImpedimentoDistribuicaoLog';
  IF (pCount <> 1) THEN
    EXECUTE IMMEDIATE '
    CREATE UNIQUE INDEX IX_IMPEDIMENTO_DISTRIBUICAO_LOG_METADATA_UUID ON SAJ_DSG.IMPEDIMENTO_DISTRIBUICAO_LOG (METADATA_UUID)
';
  END IF;
END;
/
DECLARE
  pCount NUMBER;
BEGIN
  pCount := 0;
  SELECT count(*) INTO pCount FROM SAJ_DSG."__MigrationsHistory" WHERE "MigrationId" = '20220105231648_CreateImpedimentoDistribuicaoLog';
  IF (pCount <> 1) THEN
    EXECUTE IMMEDIATE '
    INSERT INTO SAJ_DSG."__MigrationsHistory" ("MigrationId", "ProductVersion")
    VALUES (''20220105231648_CreateImpedimentoDistribuicaoLog'', ''3.1.17'')
';
  END IF;
END;
/
